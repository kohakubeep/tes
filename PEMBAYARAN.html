<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<title>Pembayaran | Warung Bunda Sri</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">

<style>
*{
  margin:0;
  padding:0;
  box-sizing:border-box;
}

body{
  min-height:100vh;
  background:linear-gradient(135deg,#ff6b6b 0%,#ee5a6f 50%,#f06292 100%);
  font-family:'Segoe UI',Tahoma,Geneva,Verdana,sans-serif;
  display:flex;
  align-items:center;
  justify-content:center;
  padding:20px;
  position:relative;
  overflow-x:hidden;
}

body::before,
body::after{
  content:'';
  position:absolute;
  border-radius:50%;
  opacity:.1;
  animation:float 20s infinite ease-in-out;
}

body::before{
  width:400px;
  height:400px;
  background:#fff;
  top:-100px;
  left:-100px;
  animation-delay:-5s;
}

body::after{
  width:300px;
  height:300px;
  background:#fff;
  bottom:-80px;
  right:-80px;
  animation-delay:-10s;
}

@keyframes float{
  0%,100%{transform:translateY(0) scale(1)}
  50%{transform:translateY(-30px) scale(1.1)}
}

.container-payment{
  max-width:550px;
  width:100%;
  position:relative;
  z-index:1;
}

.card-pay{
  background:#fff;
  border-radius:30px;
  padding:40px;
  box-shadow:0 30px 80px rgba(0,0,0,.25);
  animation:slideUp .6s ease;
  position:relative;
  overflow:hidden;
}

.card-pay::before{
  content:'';
  position:absolute;
  top:-50%;
  right:-50%;
  width:200%;
  height:200%;
  background:linear-gradient(45deg,transparent,rgba(255,255,255,.1),transparent);
  transform:rotate(45deg);
  animation:shine 3s infinite;
}

@keyframes shine{
  0%{transform:translateX(-100%) rotate(45deg)}
  100%{transform:translateX(100%) rotate(45deg)}
}

@keyframes slideUp{
  from{
    opacity:0;
    transform:translateY(50px);
  }
  to{
    opacity:1;
    transform:translateY(0);
  }
}

.header-section{
  text-align:center;
  margin-bottom:30px;
}

.payment-icon{
  font-size:64px;
  margin-bottom:15px;
  animation:bounce 2s infinite;
}

@keyframes bounce{
  0%,100%{transform:translateY(0)}
  50%{transform:translateY(-10px)}
}

h3{
  color:#2d3436;
  font-weight:800;
  margin-bottom:8px;
}

.subtitle{
  color:#636e72;
  font-size:15px;
}

.location-box{
  background:linear-gradient(135deg,#667eea,#764ba2);
  border-radius:20px;
  padding:20px;
  margin-bottom:20px;
  box-shadow:0 5px 15px rgba(102,126,234,.3);
}

.location-status{
  display:flex;
  align-items:center;
  justify-content:center;
  color:#fff;
  font-size:14px;
  gap:10px;
}

.location-status.loading{
  opacity:.8;
}

.location-icon{
  font-size:24px;
}

.location-text{
  font-weight:600;
}

.location-detail{
  color:#fff;
  font-size:12px;
  text-align:center;
  margin-top:10px;
  opacity:.9;
}

.total-section{
  background:linear-gradient(135deg,#ff6b6b,#ee5a6f);
  border-radius:20px;
  padding:25px;
  text-align:center;
  margin-bottom:30px;
  box-shadow:0 8px 25px rgba(255,107,107,.3);
}

.total-label{
  color:#fff;
  font-size:14px;
  opacity:.9;
  margin-bottom:5px;
}

.total-amount{
  color:#fff;
  font-size:36px;
  font-weight:900;
  text-shadow:2px 2px 4px rgba(0,0,0,.2);
}

.method-btn{
  border-radius:18px;
  padding:18px;
  font-weight:600;
  margin-bottom:15px;
  border:none;
  transition:all .3s ease;
  position:relative;
  overflow:hidden;
}

.method-btn::before{
  content:'';
  position:absolute;
  top:50%;
  left:50%;
  width:0;
  height:0;
  border-radius:50%;
  background:rgba(255,255,255,.3);
  transform:translate(-50%,-50%);
  transition:width .6s,height .6s;
}

.method-btn:hover::before{
  width:300px;
  height:300px;
}

.method-btn:hover{
  transform:translateY(-3px);
  box-shadow:0 8px 20px rgba(0,0,0,.2);
}

.method-btn span{
  position:relative;
  z-index:1;
}

.btn-cash{
  background:linear-gradient(135deg,#11998e,#38ef7d);
  color:#fff;
}

.btn-qris{
  background:linear-gradient(135deg,#667eea,#764ba2);
  color:#fff;
}

.btn-wallet{
  background:linear-gradient(135deg,#f093fb,#f5576c);
  color:#fff;
}

.ewallet-box{
  animation:slideUp .5s ease;
  margin-top:25px;
}

.ewallet-title{
  text-align:center;
  font-weight:700;
  color:#2d3436;
  margin-bottom:20px;
}

.ewallet-btn{
  background:#fff;
  border:2px solid #e1e8ed;
  border-radius:15px;
  padding:15px;
  margin-bottom:12px;
  font-weight:600;
  transition:all .3s ease;
  color:#2d3436;
}

.ewallet-btn:hover{
  border-color:#667eea;
  background:#f8f9ff;
  transform:translateX(5px);
}

.ewallet-number{
  background:linear-gradient(135deg,#667eea,#764ba2);
  color:#fff;
  padding:20px;
  border-radius:18px;
  font-size:16px;
  font-weight:600;
  text-align:center;
  margin:20px 0;
  box-shadow:0 5px 15px rgba(102,126,234,.3);
}

.btn-confirm{
  background:linear-gradient(135deg,#11998e,#38ef7d);
  border:none;
  border-radius:18px;
  padding:15px;
  color:#fff;
  font-weight:600;
  margin-top:15px;
}

.btn-confirm:hover{
  transform:scale(1.02);
  box-shadow:0 5px 20px rgba(56,239,125,.4);
}

.success-box{
  text-align:center;
  animation:zoomIn .6s ease;
  margin-top:20px;
}

@keyframes zoomIn{
  from{
    opacity:0;
    transform:scale(.5);
  }
  to{
    opacity:1;
    transform:scale(1);
  }
}

.check-icon{
  width:100px;
  height:100px;
  background:linear-gradient(135deg,#11998e,#38ef7d);
  border-radius:50%;
  display:flex;
  align-items:center;
  justify-content:center;
  margin:0 auto 20px;
  font-size:50px;
  color:#fff;
  box-shadow:0 10px 30px rgba(17,153,142,.3);
  animation:checkPulse 1.5s infinite;
}

@keyframes checkPulse{
  0%,100%{transform:scale(1)}
  50%{transform:scale(1.05)}
}

.success-title{
  color:#2d3436;
  font-weight:800;
  margin-bottom:10px;
}

.success-message{
  color:#636e72;
  margin-bottom:25px;
}

.btn-receipt{
  background:#fff;
  border:2px solid #dfe6e9;
  color:#2d3436;
  border-radius:15px;
  padding:12px;
  margin-bottom:12px;
  font-weight:600;
  transition:all .3s ease;
}

.btn-receipt:hover{
  border-color:#667eea;
  background:#f8f9ff;
}

.btn-home{
  background:linear-gradient(135deg,#667eea,#764ba2);
  border:none;
  border-radius:15px;
  padding:12px;
  color:#fff;
  font-weight:600;
}

.btn-home:hover{
  transform:scale(1.02);
  box-shadow:0 5px 20px rgba(102,126,234,.4);
}

footer{
  position:fixed;
  bottom:0;
  left:0;
  right:0;
  background:rgba(0,0,0,.8);
  backdrop-filter:blur(10px);
  color:#fff;
  text-align:center;
  padding:15px;
  font-size:14px;
  z-index:999;
}

.hidden{
  display:none;
}

.loading{
  display:inline-block;
  width:20px;
  height:20px;
  border:3px solid rgba(255,255,255,.3);
  border-radius:50%;
  border-top-color:#fff;
  animation:spin 1s ease-in-out infinite;
}

@keyframes spin{
  to{transform:rotate(360deg)}
}

.cart-preview{
  background:#f8f9fa;
  border-radius:15px;
  padding:15px;
  margin-bottom:20px;
  max-height:200px;
  overflow-y:auto;
}

.cart-item{
  display:flex;
  justify-content:space-between;
  padding:8px 0;
  border-bottom:1px dashed #dee2e6;
}

.cart-item:last-child{
  border-bottom:none;
}

.item-name{
  color:#2d3436;
  font-weight:500;
}

.item-price{
  color:#ff6b6b;
  font-weight:700;
}

@media (max-width:576px){
  .card-pay{
    padding:30px 20px;
  }
  
  .payment-icon{
    font-size:48px;
  }
  
  .total-amount{
    font-size:28px;
  }
}
</style>
</head>

<body>

<div class="container-payment">
  <div class="card-pay">
    
    <div class="header-section">
      <div class="payment-icon">ğŸ’³</div>
      <h3>Pembayaran</h3>
      <p class="subtitle">Warung Bunda Sri</p>
    </div>

    <!-- Location Box -->
    <div class="location-box" id="locationBox">
      <div class="location-status loading" id="locationStatus">
        <span class="location-icon">ğŸ“</span>
        <span class="location-text">Mendeteksi lokasi Anda...</span>
      </div>
      <div class="location-detail hidden" id="locationDetail"></div>
    </div>

    <!-- Cart Preview -->
    <div class="cart-preview" id="cartPreview"></div>

    <!-- Total -->
    <div class="total-section">
      <div class="total-label">Total Pembayaran</div>
      <div class="total-amount" id="totalBayar">Rp 0</div>
    </div>

    <!-- Payment Methods -->
    <div id="methodSection">
      <button class="btn method-btn btn-cash w-100" onclick="bayarLangsung()">
        <span>ğŸ§¾ Bayar Langsung di Kasir</span>
      </button>
      
      <button class="btn method-btn btn-qris w-100" onclick="bayarQRIS()">
        <span>ğŸ“± Bayar dengan QRIS</span>
      </button>
      
      <button class="btn method-btn btn-wallet w-100" onclick="tampilEwallet()">
        <span>ğŸ’¼ Bayar dengan E-Wallet</span>
      </button>
    </div>

    <!-- E-Wallet Section -->
    <div class="ewallet-box hidden" id="ewalletBox">
      <h5 class="ewallet-title">Pilih E-Wallet Anda</h5>

      <button class="btn ewallet-btn w-100" onclick="pilihEwallet('OVO','0812-3456-7890')">
        ğŸ’³ OVO
      </button>
      
      <button class="btn ewallet-btn w-100" onclick="pilihEwallet('DANA','0857-1111-2222')">
        ğŸ’µ DANA
      </button>
      
      <button class="btn ewallet-btn w-100" onclick="pilihEwallet('GoPay','0899-8888-7777')">
        ğŸŸ¢ GoPay
      </button>

      <div class="ewallet-number hidden" id="walletNumber"></div>

      <button class="btn btn-confirm w-100 hidden" id="confirmBtn" onclick="konfirmasiEwallet()">
        âœ… Saya Sudah Transfer
      </button>
    </div>

    <!-- Success Section -->
    <div class="success-box hidden" id="successBox">
      <div class="check-icon">âœ“</div>
      <h4 class="success-title">Pembayaran Berhasil!</h4>
      <p class="success-message" id="infoAkhir"></p>

      <button class="btn btn-receipt w-100" onclick="cetakStruk()">
        ğŸ§¾ Lihat Struk
      </button>
      
      <a href="HOME.html" class="btn btn-home w-100">
        ğŸ  Kembali ke Beranda
      </a>
    </div>

  </div>
</div>

<footer>Â© 2025 Warung Bunda Sri - Melayani dengan Sepenuh Hati â¤ï¸</footer>

<script>
// ================= DATA =================
const cart = JSON.parse(localStorage.getItem('cart')) || [];
const total = cart.reduce((s,i)=>s+i.price,0);
let metodeBayar = '';
let userLocation = null;

// Get current user info
const currentUser = JSON.parse(localStorage.getItem('currentUser')) || {nama: 'Tamu', telepon: '-'};

// Display cart items
function displayCart(){
  const preview = document.getElementById('cartPreview');
  
  if(cart.length === 0){
    preview.innerHTML = '<p class="text-center text-muted mb-0">Keranjang kosong</p>';
    return;
  }
  
  preview.innerHTML = cart.map(item => `
    <div class="cart-item">
      <span class="item-name">${item.name}</span>
      <span class="item-price">Rp ${item.price.toLocaleString('id-ID')}</span>
    </div>
  `).join('');
}

// Update total
document.getElementById('totalBayar').innerText = 'Rp ' + total.toLocaleString('id-ID');
displayCart();

// ================= GET LOCATION =================
function getLocation(){
  if(navigator.geolocation){
    navigator.geolocation.getCurrentPosition(
      function(position){
        userLocation = {
          latitude: position.coords.latitude,
          longitude: position.coords.longitude,
          accuracy: position.coords.accuracy
        };
        
        document.getElementById('locationStatus').classList.remove('loading');
        document.getElementById('locationStatus').innerHTML = `
          <span class="location-icon">âœ…</span>
          <span class="location-text">Lokasi Terdeteksi</span>
        `;
        
        document.getElementById('locationDetail').classList.remove('hidden');
        document.getElementById('locationDetail').innerHTML = `
          ğŸ“ Lat: ${userLocation.latitude.toFixed(6)}, Long: ${userLocation.longitude.toFixed(6)}
        `;
      },
      function(error){
        userLocation = {
          latitude: null,
          longitude: null,
          error: error.message
        };
        
        document.getElementById('locationStatus').classList.remove('loading');
        document.getElementById('locationStatus').innerHTML = `
          <span class="location-icon">âš ï¸</span>
          <span class="location-text">Lokasi Tidak Tersedia</span>
        `;
        
        document.getElementById('locationDetail').classList.remove('hidden');
        document.getElementById('locationDetail').innerHTML = `
          Izin lokasi ditolak atau tidak tersedia
        `;
      }
    );
  } else {
    userLocation = {
      latitude: null,
      longitude: null,
      error: 'Geolocation tidak didukung'
    };
    
    document.getElementById('locationStatus').classList.remove('loading');
    document.getElementById('locationStatus').innerHTML = `
      <span class="location-icon">âŒ</span>
      <span class="location-text">Browser Tidak Mendukung</span>
    `;
  }
}

// Call get location on page load
getLocation();

// ================= SIMPAN ORDER =================
function simpanPesanan(){
  const orders = JSON.parse(localStorage.getItem('orders')) || [];

  orders.push({
    id: 'ORD-' + Date.now(),
    waktu: new Date().toLocaleString('id-ID', {
      year: 'numeric',
      month: 'long',
      day: 'numeric',
      hour: '2-digit',
      minute: '2-digit'
    }),
    metode: metodeBayar,
    total: total,
    items: cart,
    status: 'Menunggu Konfirmasi',
    customer: {
      nama: currentUser.nama,
      telepon: currentUser.telepon
    },
    location: userLocation
  });

  localStorage.setItem('orders', JSON.stringify(orders));
}

// ================= METODE PEMBAYARAN =================
function bayarLangsung(){
  metodeBayar = 'Bayar Langsung';
  simpanPesanan();
  tampilSukses('Silakan bayar langsung di kasir kami. Tunjukkan struk pesanan Anda.');
}

function bayarQRIS(){
  metodeBayar = 'QRIS';

  const btn = event.target.closest('button');
  const originalContent = btn.innerHTML;
  btn.innerHTML = '<span class="loading"></span>';
  btn.disabled = true;

  setTimeout(() => {
    const link = document.createElement('a');
    link.href = 'qris.jpg';
    link.download = 'QRIS-Warung-Bunda-Sri.jpg';
    link.click();

    simpanPesanan();
    tampilSukses('QRIS berhasil diunduh. Silakan scan dan lakukan pembayaran.<br><small>Halaman akan kembali ke beranda dalam 10 detik...</small>');

    setTimeout(() => location.href = 'HOME.html', 10000);
  }, 1000);
}

function tampilEwallet(){
  document.getElementById('methodSection').classList.add('hidden');
  document.getElementById('ewalletBox').classList.remove('hidden');
}

function pilihEwallet(nama, no){
  metodeBayar = nama;
  
  const walletNumber = document.getElementById('walletNumber');
  const confirmBtn = document.getElementById('confirmBtn');
  
  walletNumber.innerHTML = `
    <div style="font-size:20px;margin-bottom:10px;">ğŸ’° ${nama}</div>
    <div style="font-size:18px;letter-spacing:1px;">${no}</div>
    <hr style="margin:15px 0;opacity:.3;">
    <div style="font-size:15px;opacity:.9;">Total Transfer</div>
    <div style="font-size:24px;font-weight:800;">Rp ${total.toLocaleString('id-ID')}</div>
  `;
  
  walletNumber.classList.remove('hidden');
  confirmBtn.classList.remove('hidden');
}

function konfirmasiEwallet(){
  const btn = document.getElementById('confirmBtn');
  btn.innerHTML = '<span class="loading"></span> Memproses...';
  btn.disabled = true;
  
  setTimeout(() => {
    simpanPesanan();
    tampilSukses(`Pembayaran melalui ${metodeBayar} berhasil dikonfirmasi!`);
  }, 1500);
}

// ================= SUKSES =================
function tampilSukses(pesan){
  localStorage.removeItem('cart');
  
  document.getElementById('methodSection').classList.add('hidden');
  document.getElementById('ewalletBox').classList.add('hidden');
  document.getElementById('cartPreview').classList.add('hidden');
  document.getElementById('locationBox').classList.add('hidden');
  document.getElementById('successBox').classList.remove('hidden');
  document.getElementById('infoAkhir').innerHTML = pesan;
}

// ================= STRUK =================
function cetakStruk(){
  const daftar = cart.map(i => `${i.name} - Rp ${i.price.toLocaleString('id-ID')}`).join('\n');
  const waktu = new Date().toLocaleString('id-ID');
  
  let locationInfo = '';
  if(userLocation && userLocation.latitude){
    locationInfo = `ğŸ“ Lokasi: ${userLocation.latitude.toFixed(4)}, ${userLocation.longitude.toFixed(4)}`;
  } else {
    locationInfo = 'ğŸ“ Lokasi: Tidak tersedia';
  }

  const struk = `
â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘   WARUNG BUNDA SRI            â•‘
â•‘   Struk Pembayaran            â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

ğŸ‘¤ Nama: ${currentUser.nama}
ğŸ“± Telepon: ${currentUser.telepon}
${locationInfo}

ğŸ“… Waktu: ${waktu}
ğŸ’³ Metode: ${metodeBayar}

ğŸ“¦ PESANAN:
${daftar}

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
ğŸ’° TOTAL: Rp ${total.toLocaleString('id-ID')}
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

Terima kasih atas pembelian Anda! â¤ï¸
  `;

  alert(struk);
}

// Prevent empty cart
if(cart.length === 0){
  alert('Keranjang Anda kosong! Silakan tambah item terlebih dahulu.');
  window.location.href = 'HOME.html';
}
</script>

</body>
</html>